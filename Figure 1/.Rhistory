method = "silhouette",
k.max = 10) +
theme(plot.title = element_blank())
# Merge plots that check optimal # of clusters
kmeans_aten_optimal_clustering <-
plot_grid(kmeans_aten_wss,
kmeans_aten_gap,
kmeans_aten_sil,
nrow = 1)
# Make a plot that shows clusters
kmeans_aten_plot <-
kmeans_data_aten |>
kmeans(centers = 2) |>
fviz_cluster(kmeans_data_aten,
labelsize = 8,
repel = T,
ylab = '% change in MIG values',
xlab = 'Proportion of fragments bleached') +
scale_fill_manual(values = rev(htol_color_palette)) +
scale_color_manual(values = rev(htol_color_palette)) +
coord_fixed() +
theme_bw() +
theme(panel.grid = element_blank(),
plot.title = element_blank(),
legend.position = 'none')
kmeans_aten_plot
kmeans_aten_optimal_clustering
ggsave(kmeans_aten_plot,
filename = 'Figure-S01_1_aten.png',
dpi = 900,
width = 4000,
height = 4000,
units = "px")
ggsave(kmeans_aten_optimal_clustering,
filename = 'Figure-S01_2_aten.png',
dpi = 900,
width = 8000,
height = 3000,
units = "px")
kmeans_data_aten
kmeans_data_aten |>
kmeans(centers = 2)
View(kmeans_aten_plot)
kmeans_data_aten |>
kmeans(centers = 2)
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2)
View(kmeans_aten_plot_df)
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster
kmeans_aten_plot_df
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as_tibble()
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as_data_frame()
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame()
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column()
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2)
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster = 1, 'Low heat tolerance', 'High heat tolerance'))
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 1, 'Low heat tolerance', 'High heat tolerance'))
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 1,
'Low heat tolerance', 'High heat tolerance'))
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 1,
'Low',
'High'))
# Extract clusters
kmeans_amil_plot_df <-
kmeans_data_amil |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 1,
'Low',
'High'))
kmeans_amil_plot_df
# Extract clusters
kmeans_adig_plot_df <-
kmeans_data_adig |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 1,
'Low',
'High'))
kmeans_adig_plot_df
write_csv(kmeans_adig_plot_df,
'clusters_adig.csv')
write_csv(kmeans_amil_plot_df,
'clusters_amil.csv')
write_csv(kmeans_aten_plot_df,
'clusters_aten.csv')
View(survival_mig_rank)
pacman::p_load(tidyverse,
broom,
ggbeeswarm,
survminer,
survival,
tidytext,
cowplot,
factoextra)
survival_data_ranked
survival_data_RankedFinal <-
survival_data_ranked
View(survival_data_RankedFinal)
rm(survival_data_RankedFinal)
View(survival_data_ranked)
survival_data_htol <-
survival_data_ranked |>
mutate('Heat tolerance' = ifelse(11 > 50, "Low", "High"))
View(survival_data_htol)
survival_data_htol <-
survival_data_ranked |>
mutate('Heat tolerance' = ifelse(`Proportion of fragments bleached, %` > 50, "Low", "High"))
View(survival_data_htol)
survival_data_htol <-
survival_data_ranked |>
mutate('Heat tolerance' = ifelse(`Proportion of fragments bleached, %` => 50, "Low", "High"))
survival_data_htol <-
survival_data_ranked |>
mutate('Heat tolerance' = ifelse(`Proportion of fragments bleached, %` >= 50, "Low", "High"))
View(survival_data_htol)
survival_data_htol_clean <-
survival_data_htol |>
select(1,5,12,13)
View(survival_data_htol_clean)
View(mig_adig_change_clean)
View(ranking_all_mig)
rm(survival_data_htol)
rm(survival_data_htol_clean)
htol_survival_data <-
survival_data_ranked |>
mutate('Heat tolerance' = ifelse(`Proportion of fragments bleached, %` >= 50, "Low", "High"))
htol_survival_data_clean <-
htol_survival_data |>
select(1,5,12,13)
htol_mig_data <-
ranking_all_mig
View(htol_mig_data)
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`)
View(htol_survival_data_clean)
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
.default = 'Intermediate'))
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 8 ~ 'High',
Species == 'A. millepora' & Ranking >= 33 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 8 ~ 'High',
Species == 'A. tenuis' & Ranking >= 33 ~ 'Low',
.default = 'Intermediate'))
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 6 ~ 'High',
Species == 'A. millepora' & Ranking >= 25 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 8 ~ 'High',
Species == 'A. tenuis' & Ranking >= 33 ~ 'Low',
.default = 'Intermediate'))
View(htol_mig_data)
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 6 ~ 'High',
Species == 'A. millepora' & Ranking >= 25 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 5 ~ 'High',
Species == 'A. tenuis' & Ranking >= 21 ~ 'Low',
.default = 'Intermediate'))
View(htol_mig_data)
htol_survival_data_clean <-
htol_survival_data |>
select(1,5,12,13) |>
rename('Survival-based ranking' = Ranking,
'Survival-based heat tolerance' `Heat tolerance`)
htol_survival_data_clean <-
htol_survival_data |>
select(1,5,12,13) |>
rename('Survival-based ranking' = Ranking,
'Survival-based heat tolerance' = `Heat tolerance`)
htol_mig_data <-
ranking_all_mig |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 6 ~ 'High',
Species == 'A. millepora' & Ranking >= 25 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 5 ~ 'High',
Species == 'A. tenuis' & Ranking >= 21 ~ 'Low',
.default = 'Intermediate')) |>
relocate(3)
View(htol_mig_data)
htol_mig_data_clean <-
htol_mig_data |>
select(1,2,5,6)
View(htol_mig_data_clean)
htol_mig_data_clean <-
htol_mig_data |>
select(1,2,5,6) |>
rename('MIG-based ranking' = Ranking,
'MIG-based heat tolerance' = `Heat tolerance`)
View(survival_mig_rank)
View(survival_mig_standard)
View(survival_mig_rank)
View(survival_mig_rank)
htol_surv_mig_data <-
survival_mig_rank |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 6 ~ 'High',
Species == 'A. millepora' & Ranking >= 25 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 5 ~ 'High',
Species == 'A. tenuis' & Ranking >= 21 ~ 'Low',
.default = 'Intermediate')) |>
relocate(3)
View(htol_surv_mig_data)
htol_surv_mig_data <-
survival_mig_rank |>
rename(Colony = `Colony ID`) |>
mutate('Heat tolerance' = case_when(Species == 'A. digitifera' & Ranking <= 8 ~ 'High',
Species == 'A. digitifera' & Ranking >= 33 ~ 'Low',
Species == 'A. millepora' & Ranking <= 6 ~ 'High',
Species == 'A. millepora' & Ranking >= 25 ~ 'Low',
Species == 'A. tenuis' & Ranking <= 5 ~ 'High',
Species == 'A. tenuis' & Ranking >= 21 ~ 'Low',
.default = 'Intermediate'))
View(htol_surv_mig_data)
htol_surv_mig_data_clean <-
htol_surv_mig_data |>
select(1,2,6,7) |>
rename('Survival+MIG-based ranking' = Ranking,
'Survival+MIG-based heat tolerance' = `Heat tolerance`)
View(htol_surv_mig_data_clean)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_a_plot_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df)
View(kmeans_all_df)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
arrange(HeatTolerance, .by_group = ColonyID)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
arrange(HeatTolerance, .by_group = 'ColonyID')
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
arrange(HeatTolerance)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
arrange(HeatTolerance,
.by_group = T)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
group_by(ColonyID)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
group_by(ColonyID) |>
arrange(HeatTolerance,
.by_group = T) |>
ungroup()
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
group_by(ColonyID) |>
arrange(HeatTolerance,
.by_group = T)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
group_by(ColonyID) |>
arrange(HeatTolerance,
.by_group = T)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
group_by(ColonyID) |>
arrange(HeatTolerance)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
mutate(Species = case_when(str_detect(ColonyID, 'D') ~ 'A. digitifera',
str_detect(ColonyID, 'M') ~ 'A. millepora',
str_detect(ColonyID, 'T') ~ 'A. tenuis',
.default = NA)) |>
group_by(ColonyID) |>
arrange(HeatTolerance)
View(kmeans_all_df)
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
mutate(Species = case_when(str_detect(ColonyID, 'D') ~ 'A. digitifera',
str_detect(ColonyID, 'M') ~ 'A. millepora',
str_detect(ColonyID, 'T') ~ 'A. tenuis',
.default = NA)) |>
group_by(Species) |>
arrange(HeatTolerance,
.by_group = T)
View(kmeans_all_df)
View(kmeans_all_df)
htol_kmeans_data <-
kmeans_all_df |>
relocate(Species) |>
rename(Colony = ColonyID) |>
select(!Cluster)
View(htol_kmeans_data)
View(htol_surv_mig_data_clean)
htol_kmeans_data_clean <-
htol_kmeans_data |>
rename('kmeans-based heat tolerance' = HeatTolerance)
View(htol_kmeans_data_clean)
htol_merged <-
htol_survival_data_clean |>
left_join(htol_mig_data_clean)
View(htol_merged)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean) |>
left_join(htol_surv_mig_data_clean)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean) |>
left_join(htol_surv_mig_data_clean) |>
left_join(htol_kmeans_data_clean)
# Extract clusters
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 2,
'Low',
'High'))
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
mutate(Species = case_when(str_detect(ColonyID, 'D') ~ 'A. digitifera',
str_detect(ColonyID, 'M') ~ 'A. millepora',
str_detect(ColonyID, 'T') ~ 'A. tenuis',
.default = NA)) |>
group_by(Species) |>
arrange(HeatTolerance,
.by_group = T)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean) |>
left_join(htol_surv_mig_data_clean) |>
left_join(htol_kmeans_data_clean)
View(htol_merged)
htol_kmeans_data <-
kmeans_all_df |>
relocate(Species) |>
rename(Colony = ColonyID) |>
select(!Cluster)
htol_kmeans_data_clean <-
htol_kmeans_data |>
rename('kmeans-based heat tolerance' = HeatTolerance)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean) |>
left_join(htol_surv_mig_data_clean) |>
left_join(htol_kmeans_data_clean)
View(htol_merged)
# Extract clusters
kmeans_aten_plot_df <-
kmeans_data_aten |>
kmeans(centers = 2) %>%
.$cluster |>
as.data.frame() |>
rownames_to_column() |>
rename(ColonyID = 1,
Cluster = 2) |>
mutate(HeatTolerance = if_else(Cluster == 2,
'Low',
'High'))
View(kmeans_all_df)
View(kmeans_aten_plot_df)
write_csv(kmeans_aten_plot_df,
'Figure-01-A-tables/clusters_aten.csv')
kmeans_all_df <-
bind_rows(kmeans_adig_plot_df,
kmeans_amil_plot_df,
kmeans_aten_plot_df) |>
mutate(Species = case_when(str_detect(ColonyID, 'D') ~ 'A. digitifera',
str_detect(ColonyID, 'M') ~ 'A. millepora',
str_detect(ColonyID, 'T') ~ 'A. tenuis',
.default = NA)) |>
group_by(Species) |>
arrange(HeatTolerance,
.by_group = T)
htol_kmeans_data <-
kmeans_all_df |>
relocate(Species) |>
rename(Colony = ColonyID) |>
select(!Cluster)
htol_kmeans_data_clean <-
htol_kmeans_data |>
rename('kmeans-based heat tolerance' = HeatTolerance)
htol_merged <-
htol_mig_data_clean |>
left_join(htol_survival_data_clean) |>
left_join(htol_surv_mig_data_clean) |>
left_join(htol_kmeans_data_clean)
View(htol_merged)
